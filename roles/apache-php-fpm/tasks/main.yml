---
- name: Check if variable apache-php-fpm is defined to prevent error
  debug: msg={{ apache_php_fpm }}
  when: apache_php_fpm

- name: Add dotdeb apt key if needed
  apt_key: keyserver=keys.gnupg.net id=89DF5277
  when: php_repo == "dotdeb"

- name: Add dotdeb.list if needed
  apt_repository: repo="deb http://packages.dotdeb.org {{ ansible_distribution_release }} all" state=present filename='dotdeb'
  when: php_repo == "dotdeb"

- name: Install apache2
  apt: name={{ item }} cache_valid_time=86400 state=latest
  with_items:
    - apache2

- name: Install php7 if needed
  when: php_version == "7"
  apt: name={{ item }} cache_valid_time=86400 state=latest
  with_items:
    - php7.0-fpm
    - php7.0-curl
    - php7.0-redis
    - php7.0-mysql
    - php7.0-xml
    - php7.0-gd
    - php7.0-mbstring
    - php7.0-intl
    - php7.0-zip

- include: configuration.yml
- include: php-fpm.yml
- include: vhosts.yml
