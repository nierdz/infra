---
# Ip aliases
ip_failover:
  - ip: 5.39.49.16/28
  - ip: 5.39.49.17/28
  - ip: 5.39.49.18/28
  - ip: 5.39.49.19/28
  - ip: 5.39.49.20/28
  - ip: 5.39.49.21/28
  - ip: 5.39.49.22/28
  - ip: 5.39.49.23/28
  - ip: 5.39.49.24/28
  - ip: 5.39.49.25/28
  - ip: 5.39.49.26/28
  - ip: 5.39.49.27/28
  - ip: 5.39.49.28/28
  - ip: 5.39.49.29/28
  - ip: 5.39.49.30/28
  - ip: 5.39.49.31/28

# Nextcloud
mysql_root_password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          30326264646131326263353938646636303461626337313661613239653830323933366436613637
          3534303061623162343962353238393338353435366337310a633561633561643435353663663831
          38356561333131613934333439326434373136646132663165633166313039663930656663666531
          6538346663643365650a393830396631343933353531343663353435626662623363616331643939
          33316237346235323331383638646562383264373732303432393335333237323530
nextcloud_dbpassword: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          32336433326436623833303662303839383061343132643965313136303436336130633438313333
          3866633064353136326536393261346366373232323035370a653566383430333433363935313030
          33663234653430363232356264333433363738613532663166666439613735386632396266343561
          6633323566363931390a613934653865343237363534633234663035616563326165303264396439
          30653631643635316234346263363164336466366235303133383436633430643030633737643130
          3832633836323439333861366636396361633337623065323530
nextcloud_dbuser: "nextcloud"
nextcloud_dbname: "nextcloud"
nextcloud_dbhost: "localhost"
nextcloud_passwordsalt: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          39393062393438636436646665666566613661303230313330663239343733323564346635366139
          3835396138633963376465656638626534663363326533370a323230363766323164343564666134
          32653261356433666130323066376231326236373438386435336330303039653438613737616432
          6133626139656164330a643865353361343238326535636264386331386632393933346136636230
          65353933396531356662396663643339376565656662613763323564616337613537

nextcloud_secret: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          38656231303831343562376462333339383166396437626633326261393938643435656361623635
          3538626331326637663533633039666534623736343332310a316564303131646530656132393636
          63306665383261326266663230333730356465373166353430353064643635616364376365626337
          3335653430363231630a313032373237373430656236623936363031356533633236356338303437
          36306163663238396236346338663232356138653633613463636431616336653834326639313864
          38643234303264656531663066333762316663386136383732316437623362663462616465333363
          373762363566616338393439653331376237
nextcloud_instanceid: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          35653032636138363838343161363662376563623633663364316538396339616662633764663132
          3962653130326436613065366332653435333435643336360a383239623832613866323461353336
          66323533633737383932323238316332643430386332663266306631643938363833623632396338
          6237633537383736390a653138383430666563356534356366656337326263343134323037613163
          3937
nextcloud_domain: "data.igln.fr"
nextcloud_deploy_to: "/var/www/{{ nextcloud_domain }}"
nextcloud_admin_user: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          34333939373535333737386331623431626662623264363666626435386439326430323136333538
          6564643431613832316338303665663831363536333563320a656430613932376365383332326539
          64396536323161393931616564653139303632663132356661626431373931336164353965363062
          6663313931623430320a646238386336303063383362616334366433323831633362636461346336
          3033
nextcloud_admin_password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          33323430623862326632656633363332653666626365373232623832646630616662336535663830
          3431613865373432306139643165383262323638333133350a343739653531386161366237303961
          62373131313362626662333338656261343035653761313866653861653337666634653536396331
          3262316164303330380a373338616365366463643661306433326530396530346166366564643866
          62303838323934306138373334323062326639333932323831653962303439646435

# Elasticsearch
es_major_version: "7.x"
es_version: "7.8.1"
es_heap_size: "2g"
es_config:
  node.name: "{{inventory_hostname}}"
  cluster.name: "elasticsearch"
  network.host: "{{ ansible_default_ipv4.address }}"
  http.port: 9200
  bootstrap.memory_lock: true
  discovery.type: single-node
# Unless I found a way to manage certs in ansible, I disable boostrap check for now
#es_jvm_custom_parameters:
#  - "-Des.enforce.bootstrap.checks=true"
es_api_host: "{{ ansible_default_ipv4.address }}"
es_users:
  native:
    apm_system:
      password: "{{ apm_system_password }}"
    beats_system:
      password: "{{ beats_system_password }}"
    elastic:
      password: "{{ elastic_password }}"
    filebeat:
      password: "{{ filebeat_password }}"
      roles:
        - filebeat
        - ingest_admin
        - kibana_dashboard_only_user
        - kibana_user
        - monitoring_user
    kibana:
      password: "{{ kibana_password }}"
    logstash_system:
      password: "{{ logstash_system_password }}"
    metricbeat:
      password: "{{ metricbeat_password }}"
      roles:
        - metricbeat
        - ingest_admin
        - kibana_dashboard_only_user
        - kibana_user
        - monitoring_user
    nierdz:
      password: "{{ nierdz_password }}"
      roles:
        - superuser
    packetbeat:
      password: "{{ packetbeat_password }}"
      roles:
        - packetbeat
        - kibana_dashboard_only_user
        - kibana_user
    remote_monitoring_user:
      password: "{{ remote_monitoring_user_password }}"
es_roles:
  native:
    filebeat:
      cluster:
        - manage_ilm
        - manage_index_templates
        - manage_ml
        - manage_pipeline
        - monitor
      indices:
        - names: 'filebeat-*'
          privileges:
            - create_index
            - index
            - manage
            - read
    metricbeat:
      cluster:
        - manage_ilm
        - manage_index_templates
        - manage_ml
        - manage_pipeline
        - monitor
      indices:
        - names: 'metricbeat-*'
          privileges:
            - create_index
            - index
            - manage
            - read
    packetbeat:
      cluster:
        - manage_ilm
        - manage_index_templates
        - manage_ml
        - monitor
      indices:
        - names: 'packetbeat-*'
          privileges:
            - create_index
            - index
            - manage
            - read
es_enable_xpack: true
es_api_basic_auth_username: elastic
es_api_basic_auth_password: "{{ elastic_password }}"

# Filebeat
filebeat_version: "7.8.1"
filebeat_modules:
  - elasticsearch
  - kibana
  - mysql
  - nginx
  - redis
  - system

# Metricbeat
metricbeat_version: "7.8.1"
metricbeat_modules:
  - elasticsearch
  - kibana
  - mysql
  - nginx
  - php_fpm
  - redis

# Packetbet
packetbeat_version: "7.8.1"

# Kibana
kibana_version: "7.8.0"

# MySQL backup
mysql_backup_host:
  time_to_keep: "60"

mysql_backup_docker:
  container: madrabbit-mysql
  time_to_keep: "60"

# Crontabs
crontabs:
  mysql backup:
    user: root
    state: present
    job: /usr/local/bin/mysql_backup_host.sh; /usr/local/bin/mysql_backup_docker.sh
    minute: 00
    hour: 1

# Certbot
certbot_certs:
  - email: "{{ my_email }}"
    path: "/var/www/certbot"
    state: "present"
    post_hook: "/bin/systemctl restart nginx.service; cp -Lrf /etc/letsencrypt/live/{{ nextcloud_domain }}/ /etc/kibana/; chmod 700 /etc/kibana/{{ nextcloud_domain }}/; chown -R kibana:kibana /etc/kibana/{{ nextcloud_domain }}/"
    domains:
      - "{{ nextcloud_domain }}"

  - email: "{{ my_email }}"
    path: "/infra-docker/certbot"
    state: "present"
    post_hook: "pushd /infra-docker && /usr/local/bin/docker-compose -p madrabbit -f /infra-docker/docker-compose-madrabbit.yml restart madrabbit-nginx"
    domains:
      - mad-rabbit.com
      - www.mad-rabbit.com
      - media.mad-rabbit.com
      - static.mad-rabbit.com
      - tenminutestokill.com
      - www.tenminutestokill.com
      - media.tenminutestokill.com
      - static.tenminutestokill.com

  - email: "{{ my_email }}"
    path: "/infra-docker/certbot"
    state: "present"
    post_hook: "pushd /infra-docker && /usr/local/bin/docker-compose -p mnttech -f /infra-docker/docker-compose-mnttech.yml restart mnttech-nginx"
    domains:
      - mnt-tech.fr
      - www.mnt-tech.fr

  - email: "{{ my_email }}"
    path: "/infra-docker/certbot"
    state: "present"
    post_hook: "pushd /infra-docker && /usr/local/bin/docker-compose -p igln -f /infra-docker/docker-compose-igln.yml restart igln"
    domains:
      - igln.fr
      - www.igln.fr
